syntax = "proto3";

package opendut.carl.services.test_manager;

import "opendut/model/cluster/cluster.proto";
import "opendut/model/viper/run.proto";
import "opendut/model/viper/source.proto";

service TestManager {
  rpc StoreTestSuiteSourceDescriptor(StoreTestSuiteSourceDescriptorRequest) returns (StoreTestSuiteSourceDescriptorResponse) {}
  rpc DeleteTestSuiteSourceDescriptor(DeleteTestSuiteSourceDescriptorRequest) returns (DeleteTestSuiteSourceDescriptorResponse) {}
  rpc GetTestSuiteSourceDescriptor(GetTestSuiteSourceDescriptorRequest) returns (GetTestSuiteSourceDescriptorResponse) {}
  rpc ListTestSuiteSourceDescriptors(ListTestSuiteSourceDescriptorsRequest) returns (ListTestSuiteSourceDescriptorsResponse) {}

  rpc StoreTestSuiteRunDescriptor(StoreTestSuiteRunDescriptorRequest) returns (StoreTestSuiteRunDescriptorResponse) {}
  rpc DeleteTestSuiteRunDescriptor(DeleteTestSuiteRunDescriptorRequest) returns (DeleteTestSuiteRunDescriptorResponse) {}
  rpc GetTestSuiteRunDescriptor(GetTestSuiteRunDescriptorRequest) returns (GetTestSuiteRunDescriptorResponse) {}
  rpc ListTestSuiteRunDescriptors(ListTestSuiteRunDescriptorsRequest) returns (ListTestSuiteRunDescriptorsResponse) {}
}


///////////////////////////////
// TestSuiteSourceDescriptor //
///////////////////////////////

//
// StoreTestSuiteSourceDescriptorRequest
//
message StoreTestSuiteSourceDescriptorRequest {
  opendut.model.viper.TestSuiteSourceDescriptor source = 1;
}

message StoreTestSuiteSourceDescriptorResponse {
  oneof reply {
    StoreTestSuiteSourceDescriptorSuccess success = 1;
    StoreTestSuiteSourceDescriptorFailure failure = 2;
  }
}

message StoreTestSuiteSourceDescriptorSuccess {
  opendut.model.viper.TestSuiteSourceId source_id = 1;
}

message StoreTestSuiteSourceDescriptorFailure {
  oneof error {
    StoreTestSuiteSourceDescriptorFailureInternal internal = 1;
  }
}

message StoreTestSuiteSourceDescriptorFailureInternal {
  opendut.model.viper.TestSuiteSourceId source_id = 1;
  opendut.model.viper.TestSuiteSourceName source_name = 2;
  string cause = 3;
}


//
// DeleteTestSuiteSourceDescriptorRequest
//
message DeleteTestSuiteSourceDescriptorRequest {
  opendut.model.viper.TestSuiteSourceId source_id = 1;
}

message DeleteTestSuiteSourceDescriptorResponse {
  oneof reply {
    DeleteTestSuiteSourceDescriptorSuccess success = 1;
    DeleteTestSuiteSourceDescriptorFailure failure = 2;
  }
}

message DeleteTestSuiteSourceDescriptorSuccess {
  opendut.model.viper.TestSuiteSourceId source_id = 1;
}

message DeleteTestSuiteSourceDescriptorFailure {
  oneof error {
    DeleteTestSuiteSourceDescriptorFailureSourceNotFound source_not_found = 1;
    DeleteTestSuiteSourceDescriptorFailureInternal internal = 4;
    DeleteTestSuiteSourceDescriptorFailureDeploymentExists deployment_exists = 5;
  }
}

message DeleteTestSuiteSourceDescriptorFailureSourceNotFound {
  opendut.model.viper.TestSuiteSourceId source_id = 1;
}

message DeleteTestSuiteSourceDescriptorFailureInternal {
  opendut.model.viper.TestSuiteSourceId source_id = 1;
  optional opendut.model.viper.TestSuiteSourceName source_name = 2;
  string cause = 3;
}

message DeleteTestSuiteSourceDescriptorFailureDeploymentExists {
  opendut.model.viper.TestSuiteSourceId source_id = 1;
  opendut.model.cluster.ClusterId cluster_id = 2;
}


//
// GetTestSuiteSourceDescriptorRequest
//
message GetTestSuiteSourceDescriptorRequest {
  opendut.model.viper.TestSuiteSourceId source_id = 1;
}

message GetTestSuiteSourceDescriptorResponse {
  oneof reply {
    GetTestSuiteSourceDescriptorSuccess success = 1;
    GetTestSuiteSourceDescriptorFailure failure = 2;
  }
}

message GetTestSuiteSourceDescriptorSuccess {
  opendut.model.viper.TestSuiteSourceDescriptor descriptor = 1;
}

message GetTestSuiteSourceDescriptorFailure {
  oneof error {
    GetTestSuiteSourceDescriptorFailureSourceNotFound source_not_found = 1;
    GetTestSuiteSourceDescriptorFailureInternal internal = 2;
  }
}

message GetTestSuiteSourceDescriptorFailureSourceNotFound {
  opendut.model.viper.TestSuiteSourceId source_id = 1;
}

message GetTestSuiteSourceDescriptorFailureInternal {
  opendut.model.viper.TestSuiteSourceId source_id = 1;
  string cause = 2;
}


//
// ListTestSuiteSourceRequest
//
message ListTestSuiteSourceDescriptorsRequest {}

message ListTestSuiteSourceDescriptorsResponse {
  oneof reply {
    ListTestSuiteSourceDescriptorsSuccess success = 1;
    ListTestSuiteSourceDescriptorsFailure failure = 2;
  }
}

message ListTestSuiteSourceDescriptorsSuccess {
  repeated opendut.model.viper.TestSuiteSourceDescriptor sources = 1;
}

message ListTestSuiteSourceDescriptorsFailure {
  oneof error {
      ListTestSuiteSourceDescriptorsFailureInternal internal = 1;
  }
}

message ListTestSuiteSourceDescriptorsFailureInternal {
  string cause = 1;
}



////////////////////////////
// TestSuiteRunDescriptor //
////////////////////////////

//
// StoreTestSuiteRunDescriptorRequest
//
message StoreTestSuiteRunDescriptorRequest {
  opendut.model.viper.TestSuiteRunDescriptor run = 1;
}

message StoreTestSuiteRunDescriptorResponse {
  oneof reply {
    StoreTestSuiteRunDescriptorSuccess success = 1;
    StoreTestSuiteRunDescriptorFailure failure = 2;
  }
}

message StoreTestSuiteRunDescriptorSuccess {
  opendut.model.viper.TestSuiteRunId run_id = 1;
}

message StoreTestSuiteRunDescriptorFailure {
  oneof error {
    StoreTestSuiteRunDescriptorFailureInternal internal = 1;
  }
}

message StoreTestSuiteRunDescriptorFailureInternal {
  opendut.model.viper.TestSuiteRunId run_id = 1;
  string cause = 2;
}


//
// DeleteTestSuiteRunDescriptorRequest
//
message DeleteTestSuiteRunDescriptorRequest {
  opendut.model.viper.TestSuiteRunId run_id = 1;
}

message DeleteTestSuiteRunDescriptorResponse {
  oneof reply {
    DeleteTestSuiteRunDescriptorSuccess success = 1;
    DeleteTestSuiteRunDescriptorFailure failure = 2;
  }
}

message DeleteTestSuiteRunDescriptorSuccess {
  opendut.model.viper.TestSuiteRunId run_id = 1;
}

message DeleteTestSuiteRunDescriptorFailure {
  oneof error {
    DeleteTestSuiteRunDescriptorFailureRunNotFound run_not_found = 1;
    DeleteTestSuiteRunDescriptorFailureInternal internal = 4;
    DeleteTestSuiteRunDescriptorFailureDeploymentExists deployment_exists = 5;
  }
}

message DeleteTestSuiteRunDescriptorFailureRunNotFound {
  opendut.model.viper.TestSuiteRunId run_id = 1;
}

message DeleteTestSuiteRunDescriptorFailureInternal {
  opendut.model.viper.TestSuiteRunId run_id = 1;
  string cause = 2;
}

message DeleteTestSuiteRunDescriptorFailureDeploymentExists {
  opendut.model.viper.TestSuiteRunId run_id = 1;
  opendut.model.cluster.ClusterId cluster_id = 2;
}


//
// GetTestSuiteRunDescriptorRequest
//
message GetTestSuiteRunDescriptorRequest {
  opendut.model.viper.TestSuiteRunId run_id = 1;
}

message GetTestSuiteRunDescriptorResponse {
  oneof reply {
    GetTestSuiteRunDescriptorSuccess success = 1;
    GetTestSuiteRunDescriptorFailure failure = 2;
  }
}

message GetTestSuiteRunDescriptorSuccess {
  opendut.model.viper.TestSuiteRunDescriptor descriptor = 1;
}

message GetTestSuiteRunDescriptorFailure {
  oneof error {
    GetTestSuiteRunDescriptorFailureRunNotFound run_not_found = 1;
    GetTestSuiteRunDescriptorFailureInternal internal = 2;
  }
}

message GetTestSuiteRunDescriptorFailureRunNotFound {
  opendut.model.viper.TestSuiteRunId run_id = 1;
}

message GetTestSuiteRunDescriptorFailureInternal {
  opendut.model.viper.TestSuiteRunId run_id = 1;
  string cause = 2;
}


//
// ListTestSuiteRunRequest
//
message ListTestSuiteRunDescriptorsRequest {}

message ListTestSuiteRunDescriptorsResponse {
  oneof reply {
    ListTestSuiteRunDescriptorsSuccess success = 1;
    ListTestSuiteRunDescriptorsFailure failure = 2;
  }
}

message ListTestSuiteRunDescriptorsSuccess {
  repeated opendut.model.viper.TestSuiteRunDescriptor runs = 1;
}

message ListTestSuiteRunDescriptorsFailure {
  oneof error {
      ListTestSuiteRunDescriptorsFailureInternal internal = 1;
  }
}

message ListTestSuiteRunDescriptorsFailureInternal {
  string cause = 1;
}
