syntax = "proto3";

package opendut.carl.services.test_manager;

import "opendut/model/cluster/cluster.proto";
import "opendut/model/viper/deployment.proto";
import "opendut/model/viper/run.proto";
import "opendut/model/viper/source.proto";

service TestManager {
  rpc StoreViperSourceDescriptor(StoreViperSourceDescriptorRequest) returns (StoreViperSourceDescriptorResponse) {}
  rpc DeleteViperSourceDescriptor(DeleteViperSourceDescriptorRequest) returns (DeleteViperSourceDescriptorResponse) {}
  rpc GetViperSourceDescriptor(GetViperSourceDescriptorRequest) returns (GetViperSourceDescriptorResponse) {}
  rpc ListViperSourceDescriptors(ListViperSourceDescriptorsRequest) returns (ListViperSourceDescriptorsResponse) {}

  rpc StoreViperRunDescriptor(StoreViperRunDescriptorRequest) returns (StoreViperRunDescriptorResponse) {}
  rpc DeleteViperRunDescriptor(DeleteViperRunDescriptorRequest) returns (DeleteViperRunDescriptorResponse) {}
  rpc GetViperRunDescriptor(GetViperRunDescriptorRequest) returns (GetViperRunDescriptorResponse) {}
  rpc ListViperRunDescriptors(ListViperRunDescriptorsRequest) returns (ListViperRunDescriptorsResponse) {}

  rpc StoreViperRunDeployment(StoreViperRunDeploymentRequest) returns (StoreViperRunDeploymentResponse) {}
  rpc DeleteViperRunDeployment(DeleteViperRunDeploymentRequest) returns (DeleteViperRunDeploymentResponse) {}
  rpc GetViperRunDeployment(GetViperRunDeploymentRequest) returns (GetViperRunDeploymentResponse) {}
  rpc ListViperRunDeployments(ListViperRunDeploymentsRequest) returns (ListViperRunDeploymentsResponse) {}
}


///////////////////////////
// ViperSourceDescriptor //
///////////////////////////

//
// StoreViperSourceDescriptorRequest
//
message StoreViperSourceDescriptorRequest {
  opendut.model.viper.ViperSourceDescriptor source = 1;
}

message StoreViperSourceDescriptorResponse {
  oneof reply {
    StoreViperSourceDescriptorSuccess success = 1;
    StoreViperSourceDescriptorFailure failure = 2;
  }
}

message StoreViperSourceDescriptorSuccess {
  opendut.model.viper.ViperSourceId source_id = 1;
}

message StoreViperSourceDescriptorFailure {
  oneof error {
    StoreViperSourceDescriptorFailureInternal internal = 1;
  }
}

message StoreViperSourceDescriptorFailureInternal {
  opendut.model.viper.ViperSourceId source_id = 1;
  opendut.model.viper.ViperSourceName source_name = 2;
  string cause = 3;
}


//
// DeleteViperSourceDescriptorRequest
//
message DeleteViperSourceDescriptorRequest {
  opendut.model.viper.ViperSourceId source_id = 1;
}

message DeleteViperSourceDescriptorResponse {
  oneof reply {
    DeleteViperSourceDescriptorSuccess success = 1;
    DeleteViperSourceDescriptorFailure failure = 2;
  }
}

message DeleteViperSourceDescriptorSuccess {
  opendut.model.viper.ViperSourceId source_id = 1;
}

message DeleteViperSourceDescriptorFailure {
  oneof error {
    DeleteViperSourceDescriptorFailureSourceNotFound source_not_found = 1;
    DeleteViperSourceDescriptorFailureInternal internal = 4;
    DeleteViperSourceDescriptorFailureDeploymentExists deployment_exists = 5;
  }
}

message DeleteViperSourceDescriptorFailureSourceNotFound {
  opendut.model.viper.ViperSourceId source_id = 1;
}

message DeleteViperSourceDescriptorFailureInternal {
  opendut.model.viper.ViperSourceId source_id = 1;
  optional opendut.model.viper.ViperSourceName source_name = 2;
  string cause = 3;
}

message DeleteViperSourceDescriptorFailureDeploymentExists {
  opendut.model.viper.ViperSourceId source_id = 1;
  opendut.model.cluster.ClusterId cluster_id = 2;
}


//
// GetViperSourceDescriptorRequest
//
message GetViperSourceDescriptorRequest {
  opendut.model.viper.ViperSourceId source_id = 1;
}

message GetViperSourceDescriptorResponse {
  oneof reply {
    GetViperSourceDescriptorSuccess success = 1;
    GetViperSourceDescriptorFailure failure = 2;
  }
}

message GetViperSourceDescriptorSuccess {
  opendut.model.viper.ViperSourceDescriptor descriptor = 1;
}

message GetViperSourceDescriptorFailure {
  oneof error {
    GetViperSourceDescriptorFailureSourceNotFound source_not_found = 1;
    GetViperSourceDescriptorFailureInternal internal = 2;
  }
}

message GetViperSourceDescriptorFailureSourceNotFound {
  opendut.model.viper.ViperSourceId source_id = 1;
}

message GetViperSourceDescriptorFailureInternal {
  opendut.model.viper.ViperSourceId source_id = 1;
  string cause = 2;
}


//
// ListViperSourceRequest
//
message ListViperSourceDescriptorsRequest {}

message ListViperSourceDescriptorsResponse {
  oneof reply {
    ListViperSourceDescriptorsSuccess success = 1;
    ListViperSourceDescriptorsFailure failure = 2;
  }
}

message ListViperSourceDescriptorsSuccess {
  repeated opendut.model.viper.ViperSourceDescriptor sources = 1;
}

message ListViperSourceDescriptorsFailure {
  oneof error {
      ListViperSourceDescriptorsFailureInternal internal = 1;
  }
}

message ListViperSourceDescriptorsFailureInternal {
  string cause = 1;
}



////////////////////////
// ViperRunDescriptor //
////////////////////////

//
// StoreViperRunDescriptorRequest
//
message StoreViperRunDescriptorRequest {
  opendut.model.viper.ViperRunDescriptor run = 1;
}

message StoreViperRunDescriptorResponse {
  oneof reply {
    StoreViperRunDescriptorSuccess success = 1;
    StoreViperRunDescriptorFailure failure = 2;
  }
}

message StoreViperRunDescriptorSuccess {
  opendut.model.viper.ViperRunId run_id = 1;
}

message StoreViperRunDescriptorFailure {
  oneof error {
    StoreViperRunDescriptorFailureInternal internal = 1;
  }
}

message StoreViperRunDescriptorFailureInternal {
  opendut.model.viper.ViperRunId run_id = 1;
  string cause = 2;
}


//
// DeleteViperRunDescriptorRequest
//
message DeleteViperRunDescriptorRequest {
  opendut.model.viper.ViperRunId run_id = 1;
}

message DeleteViperRunDescriptorResponse {
  oneof reply {
    DeleteViperRunDescriptorSuccess success = 1;
    DeleteViperRunDescriptorFailure failure = 2;
  }
}

message DeleteViperRunDescriptorSuccess {
  opendut.model.viper.ViperRunId run_id = 1;
}

message DeleteViperRunDescriptorFailure {
  oneof error {
    DeleteViperRunDescriptorFailureRunNotFound run_not_found = 1;
    DeleteViperRunDescriptorFailureInternal internal = 4;
    DeleteViperRunDescriptorFailureDeploymentExists deployment_exists = 5;
  }
}

message DeleteViperRunDescriptorFailureRunNotFound {
  opendut.model.viper.ViperRunId run_id = 1;
}

message DeleteViperRunDescriptorFailureInternal {
  opendut.model.viper.ViperRunId run_id = 1;
  string cause = 2;
}

message DeleteViperRunDescriptorFailureDeploymentExists {
  opendut.model.viper.ViperRunId run_id = 1;
  opendut.model.cluster.ClusterId cluster_id = 2;
}


//
// GetViperRunDescriptorRequest
//
message GetViperRunDescriptorRequest {
  opendut.model.viper.ViperRunId run_id = 1;
}

message GetViperRunDescriptorResponse {
  oneof reply {
    GetViperRunDescriptorSuccess success = 1;
    GetViperRunDescriptorFailure failure = 2;
  }
}

message GetViperRunDescriptorSuccess {
  opendut.model.viper.ViperRunDescriptor descriptor = 1;
}

message GetViperRunDescriptorFailure {
  oneof error {
    GetViperRunDescriptorFailureRunNotFound run_not_found = 1;
    GetViperRunDescriptorFailureInternal internal = 2;
  }
}

message GetViperRunDescriptorFailureRunNotFound {
  opendut.model.viper.ViperRunId run_id = 1;
}

message GetViperRunDescriptorFailureInternal {
  opendut.model.viper.ViperRunId run_id = 1;
  string cause = 2;
}


//
// ListViperRunRequest
//
message ListViperRunDescriptorsRequest {}

message ListViperRunDescriptorsResponse {
  oneof reply {
    ListViperRunDescriptorsSuccess success = 1;
    ListViperRunDescriptorsFailure failure = 2;
  }
}

message ListViperRunDescriptorsSuccess {
  repeated opendut.model.viper.ViperRunDescriptor runs = 1;
}

message ListViperRunDescriptorsFailure {
  oneof error {
      ListViperRunDescriptorsFailureInternal internal = 1;
  }
}

message ListViperRunDescriptorsFailureInternal {
  string cause = 1;
}


////////////////////////
// ViperRunDeployment //
////////////////////////

//
// StoreViperRunDeploymentRequest
//
message StoreViperRunDeploymentRequest {
  opendut.model.viper.ViperRunDeployment run = 1;
}

message StoreViperRunDeploymentResponse {
  oneof reply {
    StoreViperRunDeploymentSuccess success = 1;
    StoreViperRunDeploymentFailure failure = 2;
  }
}

message StoreViperRunDeploymentSuccess {
  opendut.model.viper.ViperRunId run_id = 1;
}

message StoreViperRunDeploymentFailure {
  oneof error {
    StoreViperRunDeploymentFailureInternal internal = 1;
  }
}

message StoreViperRunDeploymentFailureInternal {
  opendut.model.viper.ViperRunId run_id = 1;
  string cause = 2;
}


//
// DeleteViperRunDeploymentRequest
//
message DeleteViperRunDeploymentRequest {
  opendut.model.viper.ViperRunId run_id = 1;
}

message DeleteViperRunDeploymentResponse {
  oneof reply {
    DeleteViperRunDeploymentSuccess success = 1;
    DeleteViperRunDeploymentFailure failure = 2;
  }
}

message DeleteViperRunDeploymentSuccess {
  opendut.model.viper.ViperRunId run_id = 1;
}

message DeleteViperRunDeploymentFailure {
  oneof error {
    DeleteViperRunDeploymentFailureRunNotFound run_not_found = 1;
    DeleteViperRunDeploymentFailureInternal internal = 4;
  }
}

message DeleteViperRunDeploymentFailureRunNotFound {
  opendut.model.viper.ViperRunId run_id = 1;
}

message DeleteViperRunDeploymentFailureInternal {
  opendut.model.viper.ViperRunId run_id = 1;
  string cause = 2;
}


//
// GetViperRunDeploymentRequest
//
message GetViperRunDeploymentRequest {
  opendut.model.viper.ViperRunId run_id = 1;
}

message GetViperRunDeploymentResponse {
  oneof reply {
    GetViperRunDeploymentSuccess success = 1;
    GetViperRunDeploymentFailure failure = 2;
  }
}

message GetViperRunDeploymentSuccess {
  opendut.model.viper.ViperRunDeployment deployment = 1;
}

message GetViperRunDeploymentFailure {
  oneof error {
    GetViperRunDeploymentFailureRunNotFound run_not_found = 1;
    GetViperRunDeploymentFailureInternal internal = 2;
  }
}

message GetViperRunDeploymentFailureRunNotFound {
  opendut.model.viper.ViperRunId run_id = 1;
}

message GetViperRunDeploymentFailureInternal {
  opendut.model.viper.ViperRunId run_id = 1;
  string cause = 2;
}


//
// ListViperRunRequest
//
message ListViperRunDeploymentsRequest {}

message ListViperRunDeploymentsResponse {
  oneof reply {
    ListViperRunDeploymentsSuccess success = 1;
    ListViperRunDeploymentsFailure failure = 2;
  }
}

message ListViperRunDeploymentsSuccess {
  repeated opendut.model.viper.ViperRunDeployment runs = 1;
}

message ListViperRunDeploymentsFailure {
  oneof error {
      ListViperRunDeploymentsFailureInternal internal = 1;
  }
}

message ListViperRunDeploymentsFailureInternal {
  string cause = 1;
}
